# 决策 005：和弦转调功能实现

## 状态
- 日期：2025-05-05
- 状态：待实现
- 实施日期：待定
- 影响：功能增强、用户体验、音乐理论应用

## 背景
当前系统主要基于固定调（默认为C调）来展示和弦。对于音乐创作和学习来说，能够灵活地在不同调性间转换是非常重要的功能。许多用户希望能够将和弦转换到其他调性，以适应不同的演奏需求或者歌手的音域。同时，从音乐理论学习角度，了解不同调性下和弦的级数关系也很有教育意义。

## 决策
实现完整的和弦转调功能，包括调性选择、半音升降和级数标记：

1. 调性选择功能
   - 添加调性选择下拉菜单（Select控件）
   - 支持所有常见调性（C, C#/Db, D, D#/Eb, E, F, F#/Gb, G, G#/Ab, A, A#/Bb, B）
   - 默认展示当前选择的调性

2. 快捷调性变更
   - 在调性选择控件旁添加升/降半调按钮
   - 点击升调按钮将当前调性升高半音
   - 点击降调按钮将当前调性降低半音
   - 调性变更需循环（如从B调升高到C调，从C调降低到B调）

3. 调性显示优化
   - 在界面显著位置显示当前调性
   - 调性变更时提供视觉反馈
   - 可选择性展示相对应的调号

4. 和弦级数标记
   - 将键盘上的CDEFGAB键标记改为罗马数字I-VII级
   - 根据当前选择的调性动态更新级数对应的实际音符
   - 大写罗马数字表示大三和弦（I、IV、V）
   - 小写罗马数字表示小三和弦（ii、iii、vi）
   - 减七和弦使用小写带圈的罗马数字（vii°）

## 影响
1. 用户体验
   - 增强音乐创作和学习的灵活性
   - 提供更专业的音乐理论支持
   - 改善不同调性下的和弦探索体验

2. 代码实现
   - 需要创建调性管理模块
   - 需要修改和弦渲染逻辑
   - 需要增加UI组件
   - 需要实现音符与级数的映射逻辑

3. 测试需求
   - 所有调性下的正确转换验证
   - UI交互流畅性测试
   - 和弦级数显示准确性测试

## 替代方案
1. 简化版转调功能
   - 仅支持常用的几个调性（C, G, D, F）
   - 优点：实现简单，满足基本需求
   - 缺点：功能不完整，不适合专业用户

2. 自动识别调性
   - 根据输入的和弦序列自动推测可能的调性
   - 优点：用户无需手动选择
   - 缺点：技术复杂度高，可能存在误判

3. 不实现级数标记
   - 仅实现调性转换，保持CDEFGAB键标记
   - 优点：实现简单，保持界面一致性
   - 缺点：不利于音乐理论学习

## 实施计划
1. UI设计与实现
   - 设计调性选择器和快捷按钮
   - 实现当前调性显示
   - 设计和实现级数标记展示

2. 功能逻辑实现
   - 创建调性转换算法
   - 实现和弦与级数的映射关系
   - 处理调性变更事件

3. 测试与优化
   - 进行不同调性下的功能测试
   - 优化用户交互体验
   - 确保在所有设备上的正常显示

## 接受标准
1. 用户可以通过UI成功选择12种不同调性
2. 升/降半调按钮正常工作且具有视觉反馈
3. 当前调性显示准确且醒目
4. 键盘上的罗马数字级数标记正确对应当前调性
5. 所有调性下的和弦转换准确无误
6. 级数与和弦的对应关系符合音乐理论
7. 界面在不同设备上正常显示且易于使用 